{% extends 'admin.html.twig' %}

{% block title %}ğŸ“¦ Catalogue des Commandes{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h2 class="text-center mb-4">ğŸ“¦ Catalogue des Commandes</h2>

        <!-- ğŸ” Search Input -->
        <div class="mb-4">
            <input type="text" id="search" class="form-control" placeholder="ğŸ” Rechercher par adresse, tÃ©lÃ©phone ou statut...">
        </div>

        <!-- ğŸ“¦ Commandes List (This will be updated dynamically) -->
        <div id="commandes-list">
            {% include 'commande/_commandes_list.html.twig' %}
        </div>
    </div>

    <!-- âœ… Live Search JavaScript -->
    <script>
        document.getElementById("search").addEventListener("input", function() {
            let query = this.value.trim();

            fetch("{{ path('app_commande_search') }}?q=" + encodeURIComponent(query))
                .then(response => response.json()) // âœ… Expect JSON response
                .then(data => {
                    let container = document.getElementById("commandes-list");
                    container.innerHTML = ""; // âœ… Clear old results

                    if (!data.success || data.commandes.length === 0) {
                        container.innerHTML = '<p class="text-center text-danger">âŒ Aucune commande trouvÃ©e.</p>';
                        return;
                    }

                    // âœ… Render new results
                    data.commandes.forEach(commande => {
                        let card = `
                    <div class="col-md-4">
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title">Commande #${commande.id}</h5>
                                <p><strong>ğŸ“… Date:</strong> ${commande.dateCreation}</p>
                                <p><strong>ğŸ“ Adresse:</strong> ${commande.deliveryAddress}</p>
                                <p><strong>â˜ï¸ Contact:</strong> ${commande.phone}</p>
                                <p><strong>ğŸ’° Montant:</strong> ${commande.totalPrice} TND</p>
                                <a href="/livraison/new/${commande.id}" class="btn btn-primary w-100">
                                    ğŸ“¦ Ajouter une Livraison
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                        container.innerHTML += card;
                    });
                })
                .catch(error => {
                    console.error("âŒ Erreur AJAX:", error);
                    document.getElementById("commandes-list").innerHTML = '<p class="text-center text-danger">âŒ Erreur lors du chargement.</p>';
                });
        });


    </script>
{% endblock %}
